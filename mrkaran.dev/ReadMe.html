<h1>ClickHouse Keeper Example</h1>
<p>An example of running a local <code>ClickHouse</code> cluster using <code>clickhouse-keeper</code> for replication.</p>
<p>Config examples accompanying the <a href="https://mrkaran.dev/posts/clickhouse-replication/">blog post</a>.</p>
<h2>Generate Config</h2>
<p><code>bash
make gen-clickhouse-config</code></p>
<h2>Run Containers</h2>
<p><code>make up</code></p>
<h2>Setup Cluster Schema</h2>
<p><code>docker-compose exec clickhouse-blue-1 clickhouse-client</code></p>
<p>Run all the commands present inside <a href="./schema.sql">schema.sql</a>.</p>
<h3>Query all shards/replicas</h3>
<p><code>sql
SELECT * FROM
(
    SELECT hostName(), *
    FROM remote('172.20.0.2', 'app', 'events_local')
    UNION ALL
    SELECT hostName(), *
    FROM remote('172.20.0.3', 'app', 'events_local')
    UNION ALL
    SELECT hostName(), *
    FROM remote('172.20.0.4', 'app', 'events_local')
    UNION ALL
    SELECT hostName(), *
    FROM remote('172.20.0.5', 'app', 'events_local')
    UNION ALL
    SELECT hostName(), *
    FROM remote('172.20.0.6', 'app', 'events_local')
    UNION ALL
    SELECT hostName(), *
    FROM remote('172.20.0.7', 'app', 'events_local')
);</code></p>
<p>Replace the private IPs with the <code>host_address</code> you find inside your cluster:</p>
<p><code>sql
SELECT
    host_name,
    host_address
FROM system.clusters</code></p>